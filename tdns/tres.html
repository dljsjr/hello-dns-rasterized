<html><head><meta charset="utf-8" emacsmode="-*- markdown -*-">
                            </head><body id="md" style="visibility: visible;"><meta charset="UTF-8"><meta http-equiv="content-type" content="text/html;charset=UTF-8"><meta name="viewport" content="width=600, initial-scale=1"><style>body{max-width:680px;margin:auto;padding:20px;text-align:justify;line-height:140%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-smoothing:antialiased;color:#222;font-family:Palatino,Georgia,"Times New Roman",serif}</style><style>@media print{*{-webkit-print-color-adjust:exact;text-shadow:none !important}}body{counter-reset: h1 paragraph line item list-item}@page{margin:0;size:auto}#mdContextMenu{position:absolute;background:#383838;cursor:default;border:1px solid #999;color:#fff;padding:4px 0px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,"Helvetica Neue",sans-serif;font-size:85%;font-weight:600;border-radius:4px;box-shadow:0px 3px 10px rgba(0,0,0,35%)}#mdContextMenu div{padding:0px 20px}#mdContextMenu div:hover{background:#1659d1}.md code,.md pre{font-family:Menlo,Consolas,monospace;font-size:85%;text-align:left;line-height:140%}.md .mediumToc code,.md longToc code,.md .shortToc code,.md h1 code,.md h2 code,.md h3 code,.md h4 code,.md h5 code,.md h6 code{font-size:unset}.md div.title{font-size:26px;font-weight:800;line-height:120%;text-align:center}.md div.afterTitles{height:10px}.md div.subtitle{text-align:center}.md iframe.textinsert, .md object.textinsert,.md iframe:not(.markdeep){display:block;margin-top:10px;margin-bottom:10px;width:100%;height:75vh;border:1px solid #000;border-radius:4px;background:#f5f5f4}.md .image{display:inline-block}.md img{max-width:100%;page-break-inside:avoid}.md li{text-align:left;text-indent:0}.md pre.listing {width:100%;tab-size:4;-moz-tab-size:4;-o-tab-size:4;counter-reset:line;overflow-x:auto;resize:horizontal}.md pre.listing .linenumbers span.line:before{width:30px;margin-left:-28px;font-size:80%;text-align:right;counter-increment:line;content:counter(line);display:inline-block;padding-right:13px;margin-right:8px;color:#ccc}.md div.tilde{margin:20px 0 -10px;text-align:center}.md .imagecaption,.md .tablecaption,.md .listingcaption{display:inline-block;margin:7px 5px 12px;text-align:justify;font-style:italic}.md img.pixel{image-rendering:-moz-crisp-edges;image-rendering:pixelated}.md blockquote.fancyquote{margin:25px 0 25px;text-align:left;line-height:160%}.md blockquote.fancyquote::before{content:"“";color:#DDD;font-family:Times New Roman;font-size:45px;line-height:0;margin-right:6px;vertical-align:-0.3em}.md span.fancyquote{font-size:118%;color:#777;font-style:italic}.md span.fancyquote::after{content:"”";font-style:normal;color:#DDD;font-family:Times New Roman;font-size:45px;line-height:0;margin-left:6px;vertical-align:-0.3em}.md blockquote.fancyquote .author{width:100%;margin-top:10px;display:inline-block;text-align:right}.md small{font-size:60%}.md big{font-size:150%}.md div.title,.md contents,.md .tocHeader,.md h1,.md h2,.md h3,.md h4,.md h5,.md h6,.md .shortTOC,.md .mediumTOC,.md .nonumberh1,.md .nonumberh2,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{font-family:Verdana,Helvetica,Arial,sans-serif;margin:13.4px 0 13.4px;padding:15px 0 3px;border-top:none;clear:both}.md .tocTop {display:none}.md h1,.md h2,.md h3,.md h4,.md h5,.md h6,.md .nonumberh1,.md .nonumberh2,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{page-break-after:avoid;break-after:avoid}.md svg.diagram{display:block;font-family:Menlo,Consolas,monospace;font-size:85%;text-align:center;stroke-linecap:round;stroke-width:2px;page-break-inside:avoid;stroke:#000;fill:#000}.md svg.diagram .opendot{fill:#fff}.md svg.diagram .shadeddot{fill:#CCC}.md svg.diagram .dotteddot{stroke:#000;stroke-dasharray:4;fill:none}.md svg.diagram text{stroke:none}@media print{@page{margin:1in 5mm;transform: scale(150%)}}@media print{.md .pagebreak{page-break-after:always;visibility:hidden}}.md a{font-family:Georgia,Palatino,'Times New Roman'}.md h1,.md .tocHeader,.md .nonumberh1{border-bottom:3px solid;font-size:20px;font-weight:bold;}.md h1,.md .nonumberh1{counter-reset:h2 h3 h4 h5 h6}.md h2,.md .nonumberh2{counter-reset:h3 h4 h5 h6;border-bottom:2px solid #999;color:#555;font-weight:bold;font-size:18px;}.md h3,.md h4,.md h5,.md h6,.md .nonumberh3,.md .nonumberh4,.md .nonumberh5,.md .nonumberh6{font-family:Verdana,Helvetica,Arial,sans-serif;color:#555;font-size:16px;}.md h3{counter-reset:h4 h5 h6}.md h4{counter-reset:h5 h6}.md h5{counter-reset:h6}.md div.table{margin:16px 0 16px 0}.md table{border-collapse:collapse;line-height:140%;page-break-inside:avoid}.md table.table{margin:auto}.md table.calendar{width:100%;margin:auto;font-size:11px;font-family:Verdana,Helvetica,Arial,sans-serif}.md table.calendar th{font-size:16px}.md .today{background:#ECF8FA}.md .calendar .parenthesized{color:#999;font-style:italic}.md table.table th{color:#FFF;background-color:#AAA;border:1px solid #888;padding:8px 15px 8px 15px}.md table.table td{padding:5px 15px 5px 15px;border:1px solid #888}.md table.table tr:nth-child(even){background:#EEE}.md pre.tilde{border-top: 1px solid #CCC;border-bottom: 1px solid #CCC;padding: 5px 0 5px 20px;margin:0 0 0 0;background:#FCFCFC;page-break-inside:avoid}.md a.target{width:0px;height:0px;visibility:hidden;font-size:0px;display:inline-block}.md a:link, .md a:visited{color:#38A;text-decoration:none}.md a:link:hover{text-decoration:underline}.md dt{font-weight:700}.md dl>dd{margin-top:-8px; margin-bottom:8px}.md dl>table{margin:35px 0 30px}.md code{page-break-inside:avoid;} @media print{.md .listing code{white-space:pre-wrap}}.md .endnote{font-size:13px;line-height:15px;padding-left:10px;text-indent:-10px}.md .bib{padding-left:80px;text-indent:-80px;text-align:left}.markdeepFooter{font-size:9px;text-align:right;padding-top:80px;color:#999}.md .mediumTOC{float:right;font-size:12px;line-height:15px;border-left:1px solid #CCC;padding-left:15px;margin:15px 0px 15px 25px}.md .mediumTOC .level1{font-weight:600}.md .longTOC .level1{font-weight:600;display:block;padding-top:12px;margin:0 0 -20px}.md .shortTOC{text-align:center;font-weight:bold;margin-top:15px;font-size:14px}.md .img-attrib-container .img-attrib{font-size:50%;line-height:120%;writing-mode:vertical-rl;position:absolute;bottom:0;right:0;padding:8px 4px;color:#FFF;background-color:rgba(0,0,0,.3)}.md .img-attrib-container .img-attrib a{color:#FFF;text-decoration:none}.md .admonition{position:relative;margin:1em 0;padding:.4rem 1rem;border-radius:.2rem;border-left:2.5rem solid rgba(68,138,255,.4);background-color:rgba(68,138,255,.15);}.md .admonition-title{font-weight:bold;border-bottom:solid 1px rgba(68,138,255,.4);padding-bottom:4px;margin-bottom:4px;margin-left: -1rem;padding-left:1rem;margin-right:-1rem;border-color:rgba(68,138,255,.4)}.md .admonition.tip{border-left:2.5rem solid rgba(50,255,90,.4);background-color:rgba(50,255,90,.15)}.md .admonition.tip::before{content:"\24d8";font-weight:bold;font-size:150%;position:relative;top:3px;color:rgba(26,128,46,.8);left:-2.95rem;display:block;width:0;height:0}.md .admonition.tip>.admonition-title{border-color:rgba(50,255,90,.4)}.md .admonition.warn,.md .admonition.warning{border-left:2.5rem solid rgba(255,145,0,.4);background-color:rgba(255,145,0,.15)}.md .admonition.warn::before,.md .admonition.warning::before{content:"\26A0";font-weight:bold;font-size:150%;position:relative;top:2px;color:rgba(128,73,0,.8);left:-2.95rem;display:block;width:0;height:0}.md .admonition.warn>.admonition-title,.md .admonition.warning>.admonition-title{border-color:rgba(255,145,0,.4)}.md .admonition.error{border-left: 2.5rem solid rgba(255,23,68,.4);background-color:rgba(255,23,68,.15)}.md .admonition.error>.admonition-title{border-color:rgba(255,23,68,.4)}.md .admonition.error::before{content: "\2612";font-family:"Arial";font-size:200%;position:relative;color:rgba(128,12,34,.8);top:-2px;left:-3rem;display:block;width:0;height:0}.md .admonition p:last-child{margin-bottom:0}.md li.checked,.md li.unchecked{list-style:none;overflow:visible;text-indent:-1.2em}.md li.checked:before,.md li.unchecked:before{content:"\2611";display:block;float:left;width:1em;font-size:120%}.md li.unchecked:before{content:"\2610"}</style><style>.md h1::before {
content:counter(h1) " ";
counter-increment: h1;margin-right:10px}

.md h2::before {
content:counter(h1) "."counter(h2) " ";
counter-increment: h2;margin-right:10px}

.md h3::before {
content:counter(h1) "."counter(h2) "."counter(h3) " ";
counter-increment: h3;margin-right:10px}

.md h4::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) " ";
counter-increment: h4;margin-right:10px}

.md h5::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) "."counter(h5) " ";
counter-increment: h5;margin-right:10px}

.md h6::before {
content:counter(h1) "."counter(h2) "."counter(h3) "."counter(h4) "."counter(h5) "."counter(h6) " ";
counter-increment: h6;margin-right:10px}

</style><style>.hljs{display:block;overflow-x:auto;padding:0.5em;background:#fff;color:#000;-webkit-text-size-adjust:none}.hljs-comment{color:#006a00}.hljs-keyword{color:#02E}.hljs-literal,.nginx .hljs-title{color:#aa0d91}.method,.hljs-list .hljs-title,.hljs-tag .hljs-title,.setting .hljs-value,.hljs-winutils,.tex .hljs-command,.http .hljs-title,.hljs-request,.hljs-status,.hljs-name{color:#008}.hljs-envvar,.tex .hljs-special{color:#660}.hljs-string{color:#c41a16}.hljs-tag .hljs-value,.hljs-cdata,.hljs-filter .hljs-argument,.hljs-attr_selector,.apache .hljs-cbracket,.hljs-date,.hljs-regexp{color:#080}.hljs-sub .hljs-identifier,.hljs-pi,.hljs-tag,.hljs-tag .hljs-keyword,.hljs-decorator,.ini .hljs-title,.hljs-shebang,.hljs-prompt,.hljs-hexcolor,.hljs-rule .hljs-value,.hljs-symbol,.hljs-symbol .hljs-string,.hljs-number,.css .hljs-function,.hljs-function .hljs-title,.coffeescript .hljs-attribute{color:#A0C}.hljs-function .hljs-title{font-weight:bold;color:#000}.hljs-class .hljs-title,.smalltalk .hljs-class,.hljs-type,.hljs-typename,.hljs-tag .hljs-attribute,.hljs-doctype,.hljs-class .hljs-id,.hljs-built_in,.setting,.hljs-params,.clojure .hljs-attribute{color:#5c2699}.hljs-variable{color:#3f6e74}.css .hljs-tag,.hljs-rule .hljs-property,.hljs-pseudo,.hljs-subst{color:#000}.css .hljs-class,.css .hljs-id{color:#9b703f}.hljs-value .hljs-important{color:#ff7700;font-weight:bold}.hljs-rule .hljs-keyword{color:#c5af75}.hljs-annotation,.apache .hljs-sqbracket,.nginx .hljs-built_in{color:#9b859d}.hljs-preprocessor,.hljs-preprocessor *,.hljs-pragma{color:#643820}.tex .hljs-formula{background-color:#eee;font-style:italic}.diff .hljs-header,.hljs-chunk{color:#808080;font-weight:bold}.diff .hljs-change{background-color:#bccff9}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-comment .hljs-doctag{font-weight:bold}.method .hljs-id{color:#000}</style><style>div.title { padding-top: 40px; } div.afterTitles { height: 15px; }</style><meta charset="utf-8" emacsmode="-*- markdown -*-">
                            <span class="md"><p><title>A warm welcome to DNS</title></p><div class="title"> A warm welcome to DNS </div>

<div class="afterTitles"></div>

<p></p><p>

Note: this page is part of the
'<a href="/">hello-dns</a>' documentation effort.

</p>
<div class="longTOC"><div class="tocHeader">Contents</div><p><a href="#" class="tocTop">(Top)</a><br>
<a href="#teachingresolver" class="level1"><span class="tocNumber">1&nbsp; </span>teaching Resolver</a><br>
<a href="#currentstatus" class="level1"><span class="tocNumber">2&nbsp; </span>Current status</a><br>
<a href="#infrastructure" class="level1"><span class="tocNumber">3&nbsp; </span>Infrastructure</a><br>
<a href="#algorithm" class="level1"><span class="tocNumber">4&nbsp; </span>Algorithm</a><br>
&nbsp;&nbsp;<a href="#algorithm/hints" class="level2"><span class="tocNumber">4.1&nbsp; </span>Hints</a><br>
&nbsp;&nbsp;<a href="#algorithm/resolvingnames" class="level2"><span class="tocNumber">4.2&nbsp; </span>Resolving names</a><br>
&nbsp;&nbsp;<a href="#algorithm/traceoutput" class="level2"><span class="tocNumber">4.3&nbsp; </span>Trace output</a><br>
<a href="#furtherdetails" class="level1"><span class="tocNumber">5&nbsp; </span>Further details</a><br>
<a href="#compilingandrunningtres" class="level1"><span class="tocNumber">6&nbsp; </span>Compiling and running tres</a><br>
</p></div><a class="target" name="teachingresolver">&nbsp;</a><a class="target" name="teachingresolver">&nbsp;</a><a class="target" name="toc1">&nbsp;</a><h1>teaching Resolver</h1>
<p>

Welcome to <code>tres</code>, a 'from scratch' teaching resolver,
implementing a basic resolver in 500 lines of code.  Code is
<a href="https://github.com/ahupowerdns/hello-dns/tree/master/tdns">here</a>.  To
compile, see the end of this document.

</p><p>

Even though the 'hello-dns' documents describe how basic DNS works,  nothing
quite says how to do things like actual running code.  <code>tres</code> is small
enough to read in one sitting and shows how DNS packets are parsed and
generated.  <code>tres</code> is currently written in C++ 2014, and is MIT licensed.
Reimplementations in other languages are highly welcome, as these may be
more accessible to other programmers.

</p><p>

Please contact <a href="mailto:bert.hubert@powerdns.com">bert.hubert@powerdns.com</a> or
<a href="https://twitter.com/PowerDNS_Bert">@PowerDNS_Bert</a> if you have plans or
feedback.

</p><p>

The goals of <code>tres</code> are:

</p><p>

</p><ul>
 <li class="asterisk">Showing the DNS resolver algorithm 'in code'
</li>
 <li class="asterisk">Protocol correctness, except where the protocol needs updating
</li>
 <li class="asterisk">Suitable for educational purposes
</li>
 <li class="asterisk">Display best practices, both in DNS and security
</li>
 <li class="asterisk"><strong class="asterisk">Be a living warning for how hard it is to write a resolver correctly</strong></li></ul>

<p></p><p>

Non-goals are:

</p><p>

</p><ul>
 <li class="asterisk">Performance
</li>
 <li class="asterisk">Implementing more features (unless very educational)
</li>
 <li class="asterisk">DNSSEC
</li>
 <li class="asterisk">Resolving domains that are broken.</li></ul>

<p></p><p>

A more narrative explanation of what <code>tdns</code> is and what we hope it will
achieve can be found <a href="intro.html">here</a>.

</p>
<a class="target" name="currentstatus">&nbsp;</a><a class="target" name="currentstatus">&nbsp;</a><a class="target" name="toc2">&nbsp;</a><h1>Current status</h1>
<p>

<code>tres</code> can be used to browse the web successfully.  All popular domains
work.  The code is not quite in a teachable state yet and still contains
some ugly bits.  But well worth <a href="tres.cc">a
read</a>.

</p>
<a class="target" name="infrastructure">&nbsp;</a><a class="target" name="infrastructure">&nbsp;</a><a class="target" name="toc3">&nbsp;</a><h1>Infrastructure</h1>
<p>

<code>tres</code> uses the same DNS packet parsing/generating code as the <code>tdns</code>
authoritative server. For details, please see <a href="/tdns">its
documentation</a>.

</p>
<a class="target" name="algorithm">&nbsp;</a><a class="target" name="algorithm">&nbsp;</a><a class="target" name="toc4">&nbsp;</a><h1>Algorithm</h1>
<p>

<code>tres</code> implements a straightforward resolving algorithm.

</p>
<a class="target" name="hints">&nbsp;</a><a class="target" name="algorithm/hints">&nbsp;</a><a class="target" name="toc4.1">&nbsp;</a><h2>Hints</h2>
<p>

Resolvers should come with a list of nameserver IP addresses that function
as 'hints'. The idea is that if at least one of the hint IP addresses is
still in operation, the full set of Internet root-servers can be retrieved.

</p><p>

<code>tres</code> has its hints compiled in. Customarily, resolvers are expected to be
able to read hints from a file at startup.

</p><p>

<code>tres</code> asks the hint IP addresses for the NS records for the root zone, and
expects to receive A and AAAA records for the root-servers in return.

</p>
<a class="target" name="resolvingnames">&nbsp;</a><a class="target" name="algorithm/resolvingnames">&nbsp;</a><a class="target" name="toc4.2">&nbsp;</a><h2>Resolving names</h2>
<p>

To resolve a name (for a given type), a query for it is sent to the root
servers. These will in general not know the answer, but will provide a
delegation to other nameservers, typically with glue that provides IP
addresses.

</p><p>

<code>tres</code> will try to use that glue to follow the delegation, and this
generally succeeds. If it doesn't the resolving algorithm itself is used to
resolve addresses of the nameserver names we do have.

</p>
<a class="target" name="traceoutput">&nbsp;</a><a class="target" name="algorithm/traceoutput">&nbsp;</a><a class="target" name="toc4.3">&nbsp;</a><h2>Trace output</h2>
<p>

When run in single-shot mode (ie, <code>./tres www.powerdns.org A</code>), a file
called <code>plot.dot</code> is created. Using <code>graphviz</code>, this can be turned into a
pretty diagram like this:

</p><pre class="listing backtick"><code><span class="line"></span><span class="hljs-built_in">dot</span> -Tpng <span class="hljs-built_in">plot</span>.<span class="hljs-built_in">dot</span> &gt; <span class="hljs-built_in">plot</span>.png</code></pre>
<a class="target" name="furtherdetails">&nbsp;</a><a class="target" name="furtherdetails">&nbsp;</a><a class="target" name="toc5">&nbsp;</a><h1>Further details</h1>
<p>

The <code>tres</code> source code is less than 500 lines of code, so it is suggested to
read it from <a href="tres.cc">beginning to end</a>. The code may make more sense after
first having studied the inner workings of the <code>tdns</code> authoritative server,
which is described <a href="/tdns">here</a>.

</p>
<a class="target" name="compilingandrunningtres">&nbsp;</a><a class="target" name="compilingandrunningtres">&nbsp;</a><a class="target" name="toc6">&nbsp;</a><h1>Compiling and running tres</h1>
<p>

This requires a recent compiler version that supports C++ 2014. If you
encounter problems, please let me know (see above for address details).

</p><pre class="listing backtick"><code><span class="line"></span><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span> --recursive https://github.com/ahupowerdns/hello-dns.git</span>
<span class="line"></span><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> hello-dns/tdns</span>
<span class="line"></span><span class="hljs-meta prompt_">$ </span><span class="language-bash">make -j4 tres</span>
<span class="line"></span><span class="hljs-meta prompt_">$ </span><span class="language-bash">./tres www.powerdns.org A</span>
<span class="line"></span>...
<span class="line"></span>Result or query for www.powerdns.org.|A
<span class="line"></span>www.powerdns.org. 3600 CNAME powerdns.org.
<span class="line"></span>www.powerdns.org. 3600 A 52.48.64.3
<span class="line"></span>Used 10 queries</code></pre><p>

To use as a network service, run:
</p><pre class="listing backtick"><code><span class="line"></span><span class="hljs-meta prompt_"># </span><span class="language-bash">./tres 127.0.0.1:53</span></code></pre><p>
<script>
window.markdeepOptions={};
window.markdeepOptions.tocStyle = &ldquo;long&rdquo;;
</script>
</p></span><div id="mdContextMenu" style="visibility:hidden"></div><div class="markdeepFooter"><i>formatted by <a href="https://casual-effects.com/markdeep" style="color:#999">Markdeep&nbsp;1.16&nbsp;&nbsp;</a></i><div style="display:inline-block;font-size:13px;font-family:'Times New Roman',serif;vertical-align:middle;transform:translate(-3px,-1px)rotate(135deg);">✒</div></div></body></html>
